# PE(Portable Executable)



1. PE란?
2. PE File Format
3. 







## 1. PE란?

PE 파일은 Windows 운영체제에서 사용되는 실행 파일 형식이다.

UNIX에서 사용되는 COFF를 기반으로 MS에서 만들었는데, 애초에는 다른 운영체제에 이식성을 좋게 하려는 의도로 제작하였으나 실제로는 Windows 계열의 운영체제에서만 사용되고 있다.

PE 파일은 32비트 형태의 실행 파일을 의미하며 PE32라는 용어를 사용하기도 한다.

64비트 형태의 실행파일은 PE+ 또는 PE32+라고 부르며 PE파일의 확장 형태이다.



## 2. PE File Format

| 종류               | 주요 확장자        |
| ------------------ | ------------------ |
| 실행계열           | EXE, SCR           |
| 라이브러리 계열    | DLL, OCX, CPL, DRV |
| 드라이버 계열      | SYS, VXD           |
| 오브젝트 파일 계열 | OBJ                |

엄밀히 이야기하면 OBJ 파일을 제외한 모든 것은 실행 가능하다. DLL, SYS 파일 등은 셸에서는 직접 실행할 수 없으나 다른 방법에서는 실행 가능하다.

PE 헤더에는 실행에 필요한 DLL들과 필요한 stack/heap 메모리의 크기를 얼마로 할지 등등 수많은 정보가 구조체 형식으로 저장되어 있다.

<img src = "https://user-images.githubusercontent.com/36766295/58426952-1334d980-80d9-11e9-94df-61ff76fe1c17.png">



이 사진은 어떤 파일이 메모리에 적재(loading or mapping)될 때의 모습을 나타낸 것으로, 많은 내용을 함축하고 있다.

DOS header부터 Section header까지를 PE 헤더, 그 밑의 Section들을 합쳐서 PE 바디(Body)라고 한다.

파일에서는 offset, 메모리에서는 VA(Virtual Address, 절대주소)로 위치를 표현한다.

파일이 메모리에 로딩되면 모양이 달라지며(Section의 크기, 위치 등), 파일의 내용은 보통 코드(.text), 데이터(.data), 리소스(.rsrc) 섹션에 나뉘어서 저장된다.

> 개발도구와 빌드 옵션에 따라서 섹션의 이름, 크기, 개수, 저장 내용등은 달라지나, 중요한 것은 각 용도별로 여러 섹션이 나뉘어서 저장된다는 것이다.

섹션 헤더에 각 Section에 대한 파일/메모리에서의 크기, 위치, 속성 등이 정의되어 있다.

PE 헤더의 끝부분과 각 섹션의 끝에는 NULL padding이라고 불리우는 영역이 존재하는데, 컴퓨터에서 파일, 메모리, 네트워크 패킷 등을 처리할 때 효율을 높이기 위해 최소 기본 단위 개념을 사용하는 것처럼 PE 파일 에도 같은 개념이 적용된 것이다.

파일/메모리에서 섹션의 사직 위치는 각 파일/메모리의 최소 기본 단위의 배수에 해당하는 위치여야 하고, 빈 공간은 NULL로 채워버린다. 위 그림을 보면 각 세션의 시작 주소가 어떤 규칙에 의해 딱딱 끊어지는 걸 볼 수 있다.